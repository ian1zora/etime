=1===_(i);if(i===i.parent.left?i.parent.left=n:i.parent.right=n,i===t?n.parent=i.parent:(i.parent===t?n.parent=i:n.parent=i.parent,i.left=t.left,i.right=t.right,i.parent=t.parent,M(i,_(t)),t===e.root?e.root=i:t===t.parent.left?t.parent.left=i:t.parent.right=i,i.left!==O&&(i.left.parent=i),i.right!==O&&(i.right.parent=i)),t.detach(),r)return V(n.parent),i!==t&&(V(i),V(i.parent)),void P();for(V(n),V(n.parent),i!==t&&(V(i),V(i.parent));n!==e.root&&0===_(n);)n===n.parent.left?(1===_(o=n.parent.right)&&(M(o,0),M(n.parent,1),R(e,n.parent),o=n.parent.right),0===_(o.left)&&0===_(o.right)?(M(o,1),n=n.parent):(0===_(o.right)&&(M(o.left,0),M(o,1),W(e,o),o=n.parent.right),M(o,_(n.parent)),M(n.parent,0),M(o.right,0),R(e,n.parent),n=e.root)):(1===_(o=n.parent.left)&&(M(o,0),M(n.parent,1),W(e,n.parent),o=n.parent.left),0===_(o.left)&&0===_(o.right)?(M(o,1),n=n.parent):(0===_(o.left)&&(M(o.right,0),M(o,1),R(e,o),o=n.parent.left),M(o,_(n.parent)),M(n.parent,0),M(o.left,0),W(e,n.parent),n=e.root));M(n,0),P()}function P(){O.parent=O,O.delta=0,O.start=0,O.end=0}function R(e,t){var n=t.right;n.delta+=t.delta,(n.delta<-1073741824||n.delta>1073741824)&&(e.requestNormalizeDelta=!0),n.start+=t.delta,n.end+=t.delta,t.right=n.left,n.left!==O&&(n.left.parent=t),n.parent=t.parent,t.parent===O?e.root=n:t===t.parent.left?t.parent.left=n:t.parent.right=n,n.left=t,t.parent=n,U(t),U(n)}function W(e,t){var n=t.left;t.delta-=n.delta,(t.delta<-1073741824||t.delta>1073741824)&&(e.requestNormalizeDelta=!0),t.start-=n.delta,t.end-=n.delta,t.left=n.right,n.right!==O&&(n.right.parent=t),n.parent=t.parent,t.parent===O?e.root=n:t===t.parent.right?t.parent.right=n:t.parent.left=n,n.right=t,t.parent=n,U(t),U(n)}function F(e){var t=e.end;if(e.left!==O){var n=e.left.maxEnd;n>t&&(t=n)}if(e.right!==O){var i=e.right.maxEnd+e.delta;i>t&&(t=i)}return t}function U(e){e.maxEnd=F(e)}function V(e){for(;e!==O;){var t=F(e);if(e.maxEnd===t)return;e.maxEnd=t,e=e.parent}}function H(e,t,n,i){return e===n?t-i:e-n}var B=function(){function e(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}re