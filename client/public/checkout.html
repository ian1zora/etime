<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - ETime Restaurant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f6c6bf; padding: 20px; }
        .checkout-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 400px; gap: 30px; }
        .checkout-form { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-section { margin-bottom: 30px; }
        .form-section h3 { margin-bottom: 15px; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .order-summary { background: white; padding: 20px; border-radius: 10px; height: fit-content; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; }
        .summary-total { border-top: 2px solid #ddd; padding-top: 10px; margin-top: 10px; font-weight: bold; font-size: 1.2em; }
        .btn-primary { background: #e74c3c; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; }
        .btn-primary:hover { background: #c0392b; }
        .error { color: #dc3545; font-size: 14px; margin-top: 5px; }
        .payment-methods { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .payment-method { border: 3px solid #ddd; padding: 20px 10px; text-align: center; cursor: pointer; border-radius: 8px; transition: all 0.2s; background: white; }
        .payment-method:hover { border-color: #007bff; transform: translateY(-2px); }
        .payment-method.selected { border-color: #007bff; background: #e7f3ff; transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,123,255,0.4); }
        .payment-method div:first-child { font-size: 32px; margin-bottom: 8px; }
        #card-section { display: none; }
        @media(max-width: 768px) { .checkout-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="checkout-container">
        <div class="checkout-form">
            <h2>Finalizar Compra</h2>
            
            <form id="checkout-form">
                <div class="form-section">
                    <h3>Informaci贸n de Env铆o</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label>Apellido *</label>
                            <input type="text" id="lastName" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Tel茅fono *</label>
                        <input type="tel" id="phone" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Direcci贸n *</label>
                        <input type="text" id="address" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ciudad *</label>
                            <input type="text" id="city" required>
                        </div>
                        <div class="form-group">
                            <label>C贸digo Postal *</label>
                            <input type="text" id="postalCode" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Notas adicionales</label>
                        <input type="text" id="notes" placeholder="Ej: Piso, departamento">
                    </div>
                </div>

                <div class="form-section">
                    <h3>M茅todo de Pago *</h3>
                    <div class="payment-methods">
                        <div class="payment-method" onclick="selectPayment('efectivo', this)">
                            <div></div>
                            <div>Efectivo</div>
                        </div>
                        <div class="payment-method" onclick="selectPayment('tarjeta', this)">
                            <div></div>
                            <div>Tarjeta</div>
                        </div>
                        <div class="payment-method" onclick="selectPayment('transferencia', this)">
                            <div></div>
                            <div>Transferencia</div>
                        </div>
                        <div class="payment-method" onclick="selectPayment('mercadopago', this)">
                            <div></div>
                            <div>MercadoPago</div>
                        </div>
                    </div>
                    <input type="hidden" id="paymentMethod" required>
                    <div class="error" id="payment-error"></div>
                </div>

                <div class="form-section" id="card-section">
                    <h3>Informaci贸n de Tarjeta</h3>
                    <div class="form-group">
                        <label>N煤mero de Tarjeta *</label>
                        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Expiraci贸n *</label>
                            <input type="text" id="expiryDate" placeholder="MM/AA">
                        </div>
                        <div class="form-group">
                            <label>CVV *</label>
                            <input type="text" id="cvv" placeholder="123">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Nombre en Tarjeta *</label>
                        <input type="text" id="cardName">
                    </div>
                </div>

                <button type="submit" class="btn-primary">Confirmar Pedido</button>
            </form>
        </div>

        <div class="order-summary">
            <h3>Resumen del Pedido</h3>
            <div id="order-items"></div>
            
            <div class="summary-item">
                <span>Subtotal:</span>
                <span id="summary-subtotal">$0.00</span>
            </div>
            <div class="summary-item">
                <span>Descuento:</span>
                <span id="summary-discount">-$0.00</span>
            </div>
            <div class="summary-item">
                <span>Impuestos (21%):</span>
                <span id="summary-tax">$0.00</span>
            </div>
            <div class="summary-item summary-total">
                <span>Total:</span>
                <span id="summary-total">$0.00</span>
            </div>
        </div>
    </div>

    <script>
        let selectedPayment = null;
        let orderData = {};

        function selectPayment(method, element) {
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedPayment = method;
            document.getElementById('paymentMethod').value = method;
            document.getElementById('payment-error').textContent = '';
            
            const cardSection = document.getElementById('card-section');
            if (method === 'tarjeta') {
                cardSection.style.display = 'block';
            } else {
                cardSection.style.display = 'none';
            }
        }

        function loadOrderSummary() {
            const orderSummary = JSON.parse(localStorage.getItem('lastOrderSummary') || 'null');
            const discount = JSON.parse(localStorage.getItem('discount') || '{"code":null,"percent":0}');
            
            if (!orderSummary || !orderSummary.items || orderSummary.items.length === 0) {
                document.getElementById('order-items').innerHTML = '<p style="color:#999;padding:10px 0;">No hay items</p>';
                return;
            }

            let subtotal = 0;
            let itemsHtml = '';

            orderSummary.items.forEach(item => {
                const price = parseFloat(item.price) || 0;
                const qty = parseInt(item.qty) || 0;
                const total = price * qty;
                subtotal += total;
                itemsHtml += `<div class="summary-item"><span>${item.name} x${qty}</span><span>$${total.toFixed(2)}</span></div>`;
            });

            document.getElementById('order-items').innerHTML = itemsHtml;

            const discountAmount = subtotal * (discount.percent / 100);
            const taxable = subtotal - discountAmount;
            const tax = taxable * 0.21;
            const total = taxable + tax;

            document.getElementById('summary-subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('summary-discount').textContent = `-$${discountAmount.toFixed(2)}`;
            document.getElementById('summary-tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('summary-total').textContent = `$${total.toFixed(2)}`;

            orderData = { items: orderSummary.items, subtotal, discount: discountAmount, tax, total, discountCode: discount.code };
        }

        document.getElementById('checkout-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!selectedPayment) {
                document.getElementById('payment-error').textContent = 'Selecciona un m茅todo de pago';
                return;
            }

            const orderNumber = Math.floor(Math.random() * 100000);
            localStorage.setItem('lastOrder', JSON.stringify({
                orderNumber,
                ...orderData,
                customer: {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    phone: document.getElementById('phone').value
                },
                payment: { method: selectedPayment }
            }));

            localStorage.removeItem('cart');
            localStorage.removeItem('discount');
            localStorage.removeItem('lastOrderSummary');
            
            window.location.href = '/confirmation.html';
        });

        loadOrderSummary();
    </script>
</body>
</html>
